{% extends 'main/base.html' %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-8">
            <h2 class="mb-4"></h2>
            
            <!-- 검색 및 필터 -->
            <div class="card mb-4">
                <div class="card-body">
                    <form method="get" class="row g-3">
                        <div class="col-md-6">
                            <input type="text" name="search" class="form-control" placeholder="검색어 입력" value="{{ search_query }}">
                        </div>
                        <div class="col-md-4">
                            <select name="region" class="form-select">
                                <option value="">모든 지역</option>
                                {% for region in regions %}
                                    <option value="{{ region }}" {% if region == region_query %}selected{% endif %}>{{ region }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-4">
                            <!-- 카테고리 검색을 위한 텍스트 입력 필드 -->
                            <input type="text" name="category" class="form-control" placeholder="카테고리 입력" value="{{ category_query }}">
                        </div>
                        <div class="col-md-2">
                            <button type="submit" class="btn btn-outline-primary w-100">검색</button>
                        </div>
                        <div class="col-md-4">
                            <select name="sort" class="form-select" onchange="this.form.submit()">
                                <option value="">정렬 기준 선택</option>
                                <option value="likes" {% if sort_query == 'likes' %}selected{% endif %}>좋아요 순</option>
                                <option value="comments" {% if sort_query == 'comments' %}selected{% endif %}>댓글 많은 순</option>
                                <option value="latest" {% if sort_query == 'latest' %}selected{% endif %}>최신순</option>
                            </select>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- 게시글 목록 -->
            {% if user.is_authenticated %}
            <div class="mb-4">
                <a href="{% url 'post_new' %}" class="btn btn-outline-primary">
                    <i class="fas fa-plus"></i> 새 게시글 작성
                </a>
            </div>
            {% endif %}
            
            {% for post in posts %}
            <div class="card mb-3">
                <div class="card-body d-flex justify-content-between align-items-center">
                    <div>
                        <h5 class="card-title mb-0">
                            <a href="{% url 'post_detail' post.pk %}" class="text-decoration-none">
                                {% if post.image %}
                                <img src="{{ post.image.url }}" alt="{{ post.title }}" class="img-thumbnail me-2" style="width: 50px; height: auto;">
                                {% endif %}
                                {{ post.title }}
                            </a>
                        </h5>
                        <small class="text-muted">
                            {{ post.author.username }} | {{ post.date_posted|date:"Y-m-d" }}
                            {% if post.region %}
                            | <i class="fas fa-map-marker-alt"></i> {{ post.region }}
                            {% endif %}
                        </small>
                    </div>
                    <div>
                        <i class="fas fa-heart text-danger"></i> {{ post.likes.count }}
                        <i class="fas fa-comment ms-2"></i> {{ post.comments.count }}
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="alert alert-info">
                게시글이 없습니다.
            </div>
            {% endfor %}
        </div>
        
        <div class="col-md-4">
            <!-- 사이드바 -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">지역별 게시글</h5>
                </div>
                <div class="card-body">
                    <div class="list-group">
                        <a href="{% url 'blog' %}" class="list-group-item list-group-item-action {% if not region_query %}active{% endif %}">
                            모든 지역
                        </a>
                        {% for region in regions %}
                        <a href="{% url 'blog' %}?region={{ region }}" class="list-group-item list-group-item-action {% if region == region_query %}active{% endif %}">
                            {{ region }}
                        </a>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<style>
    .list-group-item.active {
        background-color: #343a40;
        border-color: #343a40;
        color: white;
    }
    /* 버튼 클릭 시 색상 변경 방지 */
    .btn-outline-primary:active,
    .btn-outline-primary:focus,
    .btn-outline-primary.active {
        color: #343a40 !important;
        background-color: transparent !important;
        border-color: #343a40 !important;
        box-shadow: none !important;
    }
</style>
{% endblock %}
